import { Constants } from '../common/constants/Constants';
import { BreakpointTypeEnum } from '../common/constants/Constants';
import { display } from '@kit.ArkUI';
import { HomePage } from './Home/HomePage';
import { CategoryPage } from './Category/CategoryPage';
import { CartPage } from './Cart/CartPage';

// Tabé¡¹æ•°æ®
interface TabItem {
  title: string;
  icon: string;
}

@Entry
@Component
struct Index {
  @State currentIndex: number = 0;
  @State currentBreakpoint: BreakpointTypeEnum = BreakpointTypeEnum.SM;

  // Tabé…ç½® - ä½¿ç”¨Unicodeç¬¦å·ä½œä¸ºå›¾æ ‡
  private tabList: TabItem[] = [
    { title: 'é¦–é¡µ', icon: 'ğŸ ' },
    { title: 'åˆ†ç±»', icon: 'ğŸ“‹' },
    { title: 'è´­ç‰©è½¦', icon: 'ğŸ›’' },
    { title: 'æˆ‘çš„', icon: 'ğŸ‘¤' }
  ];

  // æ›´æ–°æ–­ç‚¹
  private updateBreakpoint(windowWidth: number): void {
    if (windowWidth < 600) {
      this.currentBreakpoint = BreakpointTypeEnum.SM;
    } else if (windowWidth < 840) {
      this.currentBreakpoint = BreakpointTypeEnum.MD;
    } else {
      this.currentBreakpoint = BreakpointTypeEnum.LG;
    }
  }

  aboutToAppear(): void {
    // è·å–çª—å£å®½åº¦å¹¶è®¾ç½®æ–­ç‚¹
    try {
      const displayInfo = display.getDefaultDisplaySync();
      const widthVp = displayInfo.width / displayInfo.densityDPI * 160;
      this.updateBreakpoint(widthVp);
    } catch (error) {
      console.error('è·å–æ˜¾ç¤ºä¿¡æ¯å¤±è´¥:', JSON.stringify(error));
    }
  }

  // æ„å»ºTabæŒ‰é’®
  @Builder
  TabBuilder(index: number) {
    Column() {
      Text(this.tabList[index].icon)
        .fontSize(22)

      Text(this.tabList[index].title)
        .fontSize(10)
        .fontColor(this.currentIndex === index ? Constants.PRIMARY_COLOR : Constants.TEXT_HINT)
        .margin({ top: 4 })
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }



  // æˆ‘çš„å†…å®¹
  @Builder
  ProfileContent() {
    Column() {
      Text('æˆ‘çš„')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 20 })

      Text('ä¸ªäººä¸­å¿ƒå¼€å‘ä¸­...')
        .fontSize(14)
        .fontColor(Constants.TEXT_HINT)
        .margin({ top: 10 })
    }
    .width('100%')
    .height('100%')
    .backgroundColor(Constants.BACKGROUND_COLOR)
  }

  build() {
    Column() {
      // æ ¹æ®æ–­ç‚¹ç±»å‹å†³å®šå¸ƒå±€
      if (this.currentBreakpoint === BreakpointTypeEnum.LG) {
        // å¹³æ¿å¸ƒå±€ï¼šå·¦ä¾§å¯¼èˆª
        Row() {
          // å·¦ä¾§å¯¼èˆªæ 
          Column() {
            ForEach(this.tabList, (item: TabItem, index: number) => {
              Column() {
                Text(item.icon)
                  .fontSize(24)

                Text(item.title)
                  .fontSize(12)
                  .fontColor(this.currentIndex === index ? Constants.PRIMARY_COLOR : Constants.TEXT_HINT)
                  .margin({ top: 6 })
              }
              .width('100%')
              .padding({ top: 20, bottom: 20 })
              .backgroundColor(this.currentIndex === index ? '#FFF1F0' : Color.Transparent)
              .onClick(() => {
                this.currentIndex = index;
              })
            })

            Blank()
          }
          .width(80)
          .height('100%')
          .backgroundColor(Color.White)

          // å³ä¾§å†…å®¹åŒºåŸŸ
          Column() {
            if (this.currentIndex === 0) {
              HomePage()
            } else if (this.currentIndex === 1) {
              CategoryPage()
            } else if (this.currentIndex === 2) {
              CartPage()
            } else {
              this.ProfileContent()
            }
          }
          .layoutWeight(1)
          .height('100%')
        }
        .width('100%')
        .height('100%')
      } else {
        // æ‰‹æœº/æŠ˜å å±å¸ƒå±€ï¼šåº•éƒ¨å¯¼èˆª
        Tabs({ barPosition: BarPosition.End, index: this.currentIndex }) {
          TabContent() {
            HomePage()
          }
          .tabBar(this.TabBuilder(0))

          TabContent() {
            CategoryPage()
          }
          .tabBar(this.TabBuilder(1))

          TabContent() {
            CartPage()
          }
          .tabBar(this.TabBuilder(2))

          TabContent() {
            this.ProfileContent()
          }
          .tabBar(this.TabBuilder(3))
        }
        .scrollable(false)
        .barHeight(56)
        .barMode(BarMode.Fixed)
        .onChange((index: number) => {
          this.currentIndex = index;
        })
      }
    }
    .width('100%')
    .height('100%')
  }
}